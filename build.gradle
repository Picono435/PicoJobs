import org.apache.tools.ant.filters.*

plugins {
    id 'com.github.johnrengelman.shadow' version '8.1.1'
    id 'io.github.slimjar' version '1.3.0' apply false
    id 'java'
    id 'maven-publish'
    id 'net.nemerosa.versioning' version '3.0.0'
}

sourceCompatibility = '17'
targetCompatibility = '17'

if (System.getenv("STABLE_BUILD") != null) {
    if (System.getenv("STABLE_BUILD") == '0') {
        version versioning.info.build + "-DEV"
    } else {
        version "1.0-beta-7a"
    }
} else {
    version "1.0-beta-7a"
}

subprojects {
    apply plugin: "com.github.johnrengelman.shadow"
    apply plugin: "io.github.slimjar"

    repositories {
        maven {
            url = 'https://repo.piconodev.com/repository/maven-releases/'

            content {
                includeGroup 'io.github.slimjar'
            }
        }
    }

    dependencies {
        // Slimjar
        //shadow implementation(slimjar("1.2.6"))
        // TODO: PLEASE SHADOW THIS SHIT
        implementation 'org.apache.commons:commons-lang3:3.12.0'
        implementation 'commons-io:commons-io:2.13.0'
        implementation 'com.google.guava:guava:32.0.0-jre'
        implementation 'com.google.code.gson:gson:2.10.1'
    }

}

allprojects {
    apply plugin: "java"
    apply plugin: "maven-publish"

    archivesBaseName = rootProject.archives_base_name
    version = rootProject.version
    group = rootProject.group
    description = rootProject.description

    task sourcesJar(type: Jar, dependsOn: classes) {
        archiveClassifier.set('sources')
        from sourceSets.main.allSource
    }

    task javadocJar(type: Jar, dependsOn: javadoc) {
        archiveClassifier.set('javadoc')
        from javadoc.destinationDir
    }

    artifacts {
        archives sourcesJar
        archives javadocJar
    }
}

/*shadowJar {
    relocate 'org.bstats', 'com.gmail.picono435.picojobs.metrics'
    relocate 'org.apache', 'com.gmail.picono435.picojobs.libs.apache'
    relocate 'org.spongepowered', 'com.gmail.picono435.picojobs.libs.spongepowered'
    relocate 'com.github.mkremins', 'com.gmail.picono435.picojobs.libs.mkremins'
    relocate 'io.github.slimjar', 'com.gmail.picono435.picojobs.libs.slimjar'
    archiveClassifier = ''
}*/

publishing {
    publications {
        maven(MavenPublication) {
            groupId = project.group
            artifactId = 'picojobs'
            version = project.version
            from components.java

            pom {
                name = "PicoJobs"
                description = "An amazing plugin that allows you to create your own jobs for your players. The plugin is 100% configurable so you can change everything you see, it is also open-source if you want to take a look on how it's made."
                url = "https://github.com/Picono435/PicoJobs"
                licenses {
                    license {
                        name = "The MIT License"
                        url = "https://opensource.org/licenses/MIT"
                    }
                }
                developers {
                    developer {
                        id = "picono435"
                        name = "Picono435"
                        email = "picono435@gmail.com"
                    }
                }
                scm {
                    connection = "https://github.com/Picono435/PicoJobs"
                    developerConnection = "https://github.com/Picono435/PicoJobs.git"
                    url = "https://github.com/Picono435/PicoJobs"
                }
            }
        }
    }
    repositories {
        maven {
            credentials {
                username System.getenv("REPO_USER")
                password System.getenv("REPO_PASSWORD")
            }

            url = 'https://repo.piconodev.com/repository/maven-releases/'
        }
    }
}